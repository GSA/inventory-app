---
# To apply this manifest: cf push --vars-file vars.yml
applications:
  - name: ((app_name))
    instances: ((instances))
    buildpacks:
      - https://github.com/cloudfoundry/apt-buildpack
      - https://github.com/cloudfoundry/python-buildpack.git#v1.8.4
    services:
      - inventory-db
      - inventory-datastore
      - inventory-s3
      - inventory-redis
      - inventory-secrets
      - ((app_name))-solr
      - sysadmin-users
    routes:
      - route: ((route_internal))
    timeout: 120
    memory: ((memory_quota))
    disk_quota: ((disk_quota))
    health-check-type: http
    health-check-http-endpoint: /api/3
    command: ./config/server_start.sh
    env:
      DS_RO_USER: datastore_default
      CKANEXT__SAML2AUTH__ENTITY_ID: ((ckanext__saml2auth__entity_id))
      CKANEXT__SAML2AUTH__IDP_METADATA__LOCAL_PATH: ((ckanext__saml2auth__idp_metadata__local_path))
      CKAN_SITE_ID: inventory
      CKAN_SITE_URL: https://inventorynew-prod-datagov.apps.internal/
      SAML2_CERTIFICATE: ((saml2_certificate))
