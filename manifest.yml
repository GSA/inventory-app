---
# To apply this manifest: cf push --vars-file vars.yml
applications:
  - name: ((app_name))-solr
    docker:
      image: datagov/catalog-solr:inventory2_8
    routes:
      - route: ((solr_route))
  - name: ((app_name))
    instances: ((instances))
    buildpacks:
      - https://github.com/cloudfoundry/python-buildpack#v1.7.6
    routes: ((routes))
    services:
      - ((app_name))-db        # cf create-service aws-rds micro-psql ((app_name))-db
      - ((app_name))-datastore # cf create-service aws-rds micro-psql ((app_name))-datastore
      - ((app_name))-s3        # cf create-service s3 basic-sandbox ((app_name))-s3
      - ((app_name))-redis     # cf create-service aws-elasticache-redis redis-dev ((app_name))-redis
      - ((app_name))-secrets   # cf cups ((app_name))-secrets -p "DS_RO_PASSWORD, NEW_RELIC_LICENSE_KEY"
    env:
      DS_RO_USER: datastore_default
      CKANEXT__SAML2AUTH__ENTITY_ID: ((ckanext.saml2auth.entity_id))
      SOLR_URL: http://((solr_route)):8983/solr/ckan2_8
      NEW_RELIC_APP_NAME: ((app_name))
      NEW_RELIC_HOST: gov-collector.newrelic.com
      NEW_RELIC_LOG: /var/log/new_relic.log
      NEW_RELIC_LOG_LEVEL: info
      NEW_RELIC_MONITOR_MODE: False
      SAML2_CERTIFICATE: ((saml2_certificate))
